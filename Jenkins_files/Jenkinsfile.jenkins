pipeline {
    agent any
    stages {
        stage('Clone feature branche') {
			when {
				not {
					branch 'master'
				}
			}
            steps {
                sh 'export BRANCH=$(git branch | cut -d " " -f2)'
				sh 'git clone --branch=$BRANCH https://github.com/Threadripper1/Large-pipe.git'
            }
        }
		stage('List Docker files') {
			 when {
			 	not {
			 		branch 'master'
			 	}
			 }
			steps {
				sh 'find ./docker -name "Dockerfile" -exec cat {} \\;'
			}
		}
	}
	stage('Merge feature branch into master') {
			 when {
			 	not {
			 		branch 'master'
			 	}
			 }
			steps {
				try {
					sh 'git checkout master'
					sh 'git merge $BRANCH'
				}catch(Exeption e) {
					echo 'Pipeline error, merge failed.'
					throw
				}
			}
		}
	}
}
